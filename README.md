# infinite-fuzz-go

**A generic, reusable script for continuous Go fuzz testing within your project's test directory.**

## Overview

`infinite-fuzz.sh` is a standalone bash script that runs Go fuzz tests continuously in parallel until stopped. It automatically discovers all fuzz targets in your test files and runs them simultaneously, making it easy to run long-duration fuzzing sessions locally.

### Why This Script Exists

**Go's native fuzzing stops after finding the first issue.** When `go test -fuzz=FuzzFoo` encounters a crash or failing input, it saves the corpus file and exits. This is great for CI/CD, but not ideal for local development where you want to:

- Keep fuzzing to find multiple different issues in one session
- Run fuzzing overnight or for extended periods
- Discover as many edge cases as possible without manual restarts
- Run multiple fuzz targets in parallel to maximize coverage

This script solves that by automatically restarting fuzz tests after they find issues, allowing continuous discovery of bugs and edge cases.

## Features

- ✅ **Auto-discovery** - Automatically finds all `func Fuzz*` functions in your `*_test.go` files
- ✅ **Parallel execution** - Runs all fuzz targets simultaneously for maximum coverage
- ✅ **Easy kill** - Stop all fuzzing with `./infinite-fuzz.sh -k` or Ctrl+C
- ✅ **Selective fuzzing** - Run specific targets with `-t FuzzFoo,FuzzBar`
- ✅ **GOEXPERIMENT support** - Respects `GOEXPERIMENT` environment variable
- ✅ **Zero dependencies** - Just bash and Go, works everywhere
- ✅ **Portable** - Copy to any Go project and it just works

## Installation

### Copy to Your Project

Simply copy `infinite-fuzz.sh` to your project's test directory:

```bash
# From this repo
cp infinite-fuzz.sh /path/to/your-project/test/

# Or download directly
curl -o test/infinite-fuzz.sh https://raw.githubusercontent.com/mikeschinkel/infinite-fuzz-go/main/infinite-fuzz.sh
chmod +x test/infinite-fuzz.sh
```

That's it! The script is self-contained and has no external dependencies.

## Usage

### Basic Usage - Auto-discover All Fuzz Tests

```bash
cd test
./infinite-fuzz.sh
```

Output:
```
Auto-discovering fuzz targets...
Found 2 fuzz target(s): FuzzParseTemplate FuzzMatch
==========================================
Starting infinite fuzzing at Wed Nov 27 15:30:00 PST 2025
Targets: FuzzParseTemplate FuzzMatch
Press Ctrl+C to stop or run: infinite-fuzz.sh -k
==========================================

[FuzzParseTemplate] Starting fuzz run #1 at Wed Nov 27 15:30:00
[FuzzMatch] Starting fuzz run #1 at Wed Nov 27 15:30:00
...
```

### Stop All Fuzzing

```bash
# From the same directory
./infinite-fuzz.sh -k

# Or from anywhere
/path/to/test/infinite-fuzz.sh -k
```

### Run Specific Targets

```bash
./infinite-fuzz.sh -t FuzzParseTemplate

# Multiple targets (comma-separated, no spaces)
./infinite-fuzz.sh -t FuzzFoo,FuzzBar,FuzzBaz
```

### With GOEXPERIMENT

```bash
GOEXPERIMENT=jsonv2 ./infinite-fuzz.sh
```

### Help

```bash
./infinite-fuzz.sh -h
```

## How It Works

1. **Discovery**: Scans all `*_test.go` files in the current directory for functions matching `func Fuzz*`
2. **Parallel Execution**: Launches each fuzz target in a background process
3. **Continuous Running**: Each target runs in an infinite loop until stopped
4. **Crash Detection**: Reports when a fuzz target finds an issue
5. **Clean Shutdown**: Ctrl+C or `-k` flag properly kills all background processes

## Command-Line Options

| Option | Description |
|--------|-------------|
| `-k`, `--kill` | Kill all running fuzzing processes and exit |
| `-t`, `--targets` | Comma-separated list of fuzz targets to run (default: auto-discover) |
| `-h`, `--help` | Show help message |

## Examples

### Example 1: Run All Fuzz Tests Overnight IN BACKGROUND

```bash
cd test
echo "WARNING: This runs in background and survives terminal closing!"
echo "         To stop it, use ./infinite-fuzz.sh -k"
nohup ./infinite-fuzz.sh > fuzz.log 2>&1 &
# Check progress: tail -f fuzz.log
# Stop: ./infinite-fuzz.sh -k
```

### Example 2: Run Only Specific High-Value Targets

```bash
cd test
./infinite-fuzz.sh -t FuzzParser,FuzzValidator
```

### Example 3: Use in CI/CD for Extended Fuzzing

```yaml
# GitHub Actions workflow
- name: Extended fuzzing
  run: |
    cd test
    timeout 10m ./infinite-fuzz.sh || true
```

## Project Structure

Your Go project should have fuzz tests in test files:

```
your-project/
├── test/
│   ├── fuzz_test.go          # Contains: func FuzzParseTemplate(f *testing.F)
│   ├── infinite-fuzz.sh      # This script (copied from this repo)
│   └── testdata/
│       └── fuzz/             # Corpus files (auto-generated by fuzzer)
│           ├── FuzzParseTemplate/
│           └── FuzzMatch/
```

## Requirements

- **Go 1.18+** (native fuzzing support)
- **Bash** (standard on macOS/Linux)
- **Fuzz tests** in your project (functions named `func Fuzz*`)

## Why Use This Script?

### vs. Running Go Fuzz Manually

```bash
# Manual approach (stops after default timeout or first issue found)
go test -fuzz=FuzzParseTemplate ./test

# With this script (runs forever, multiple targets in parallel)
cd test && ./infinite-fuzz.sh
```

### vs. GitHub Actions Fuzzing

- **Cost-effective**: No CI minutes consumed
- **Better hardware**: Run on more powerful local machines
- **Continuous**: Run for hours or days, not limited by timeouts
- **Immediate feedback**: Corpus saved locally for instant analysis

## Stopping Fuzzing

### Method 1: Ctrl+C (if running in foreground)
Press `Ctrl+C` and the script will cleanly shut down all background processes.

### Method 2: Kill Flag (if running in background)
```bash
./infinite-fuzz.sh -k
```

This will:
1. Kill the `infinite-fuzz.sh` script
2. Kill all `test.test` fuzz worker processes
3. Kill all `go test` commands
4. Verify cleanup and report status

## Troubleshooting

### No Fuzz Targets Found

```
Error: No Fuzz* functions found in *_test.go files
Make sure you're in a directory with fuzz tests
```

**Solution**: Make sure you're in the directory containing `*_test.go` files with `func Fuzz*` functions.

### Processes Won't Die

If `./infinite-fuzz.sh -k` doesn't kill everything:

```bash
# Nuclear option
pkill -9 -f "test.test.*fuzz"
pkill -9 -f "go test.*fuzz"
```

## Related Projects

- [go-pathvars](https://github.com/mikeschinkel/go-pathvars) - URL path template parsing (uses this script)
- [go-sqlparams](https://github.com/mikeschinkel/go-sqlparams) - SQL parameter handling (uses this script)

## Contributing

This is a simple utility script. If you have improvements:

1. Fork this repo
2. Make your changes
3. Test with multiple Go projects
4. Submit a PR

## License

MIT License - See [LICENSE](LICENSE) file.

## Author

Mike Schinkel - [@mikeschinkel](https://github.com/mikeschinkel)

## Changelog

### v1.0.0 (2025-01-27)
- Initial release
- Auto-discovery of fuzz targets
- Parallel execution
- Kill flag for clean shutdown
- Portable across all Go projects
